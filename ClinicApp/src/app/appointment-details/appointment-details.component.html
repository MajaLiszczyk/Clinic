<div class="container">
  <h4>MEDICAL APPOINTMENT</h4>
  <p></p>
  <h5 class="display-7 d-flex justify-content-center mt-5 mb-3 pt-3 pb-3">
    <div *ngIf="medicalAppointment.isCancelled; else finishBlock">
      status: CANCELLED
    </div>
    <ng-template #finishBlock>
      <div *ngIf="medicalAppointment.isFinished; else awaitBlock">
        status: FINISHED
      </div>
    </ng-template>
    <ng-template #awaitBlock>
      status: AWAITING
    </ng-template> <br />

    Time: {{medicalAppointment.dateTime}} <br />
    Patient id: {{medicalAppointment.patientId}}

  </h5>

  <div *ngIf="isAppointmentCancelled || isCancelClicked">
    <form [formGroup]="cancelAppointmentForm">
      <div class="formGroup mb-3">
        <label for="textbox">Reason to cancel the medical appointment:</label>
        <input formControlName="cancelComment" id="cancelComment" type="text" class="form-control"
          aria-label="cancelComment"
          [class.is-invalid]="formCancelComment.invalid && (formCancelComment.touched || formCancelComment.dirty)">
        <div class="invalid-feedback">
          <span *ngIf="formCancelComment?.errors?.['required']">Required</span>
        </div>
      </div>
      <div *ngIf="isEditable">
        <button (click)="saveCancelComment()" class="btn btn-success w-50">Save comment</button>
        <button (click)="cancelCancelComment()" class="btn btn-success w-50">Cancel comment</button>
      </div>
    </form>


  </div>


  <!-- JESLI WIZYTA NIEANULOWANA - OCZEKUJĄCA LUB ZAKOŃCZONA -->
  <div *ngIf="!isAppointmentCancelled && !isCancelClicked">
    <form [formGroup]="medicalAppointmentForm">
      <div class="formGroup mb-3">
        <label for="textbox">Interview:</label>
        <input id="interview" formControlName="interviewText" type="text" class="form-control" aria-label="interview"
          [class.is-invalid]="formInterview.invalid && (formInterview.touched || formInterview.dirty)">
        <div class="invalid-feedback">
          <span *ngIf="formInterview?.errors?.['required']">Required</span>
        </div>
      </div>
      <p></p>

      <div class="formGroup mb-3">
        <label for="textbox">Diagnosis:</label>
        <input id="textbox" type="text" formControlName="diagnosisText" class="form-control"
          [class.is-invalid]="formDiagnosis.invalid && (formDiagnosis.touched || formDiagnosis.dirty)" />
        <div class="invalid-feedback">
          <span *ngIf="formDiagnosis?.errors?.['required']">Required</span>
        </div>
      </div>
    </form>

    <!-- DIAGNOSTIC TESTS-->
    <form [formGroup]="chooseDiagnosticTestTypeForm" *ngIf="isEditable">
      <div class="formGroup mb-3">
        <label for="diagnosticTypeTestType">Diagnostic Test Type:</label>
        <select id="diagnosticTypeTestType" class="form-control" formControlName="diagnosticTypeTestType">
          <option *ngFor="let diagnosticTestType of diagnosticTestTypes" [ngValue]="diagnosticTestType">
            {{ diagnosticTestType.name }}
          </option>
        </select>
      </div>
      <div>
        <div class="d-flex justify-content-center mb-4">
          <button [disabled]="isDisabled" type="button" class="btn  btn-success float-right mx-2 mt-5 "
            (click)="selectDiagnosticTestType()">Select</button>
        </div>
      </div>
    </form>

    <form [formGroup]="diagnosticTestForm" *ngIf="isDiagnosticTestAddingMode || isDiagnosticTestEditableMode">
      <label for="textbox">Type:</label>
      <input id="diagnosticTestTypeName" formControlName="diagnosticTestTypeName" type="text" class="form-control">
      <p></p>

      <label for="textbox">Description:</label>
      <input id="description" type="text" formControlName="description" />

      <div class="d-flex justify-content-center mb-4 mt-5">
        <button *ngIf="isDiagnosticTestAddingMode" type="button" class="btn  btn-success float-right mx-2 "
          (click)="saveDiagnosticTest()">Save Diagnostic Test</button>
        <button (click)="cancelAddingDiagnosticTest()" class="btn btn-secondary">Cancel</button>
        <button *ngIf="isDiagnosticTestEditableMode" type="button" class="btn  btn-success float-right mx-2 "
          (click)="updateDiagnosticTest()">Save
          etitioned diagnosticTest</button>
      </div>
    </form>

    <div class="mb-5">
      <table class="table table-striped">
        <thead class="thead-dark">
          <tr>
            <th>
              Diagnostic Test
            </th>
            <th>

            </th>
          </tr>
        </thead>
        <tr *ngFor="let pastDiagnosticTest of pastDiagnosticTests">
          <td>
            Diagnostic test type: {{pastDiagnosticTest.diagnosticTestTypeName}}
            <br />
            Description: {{pastDiagnosticTest.description}}
          </td>
          <td *ngIf="isEditable">
            <button [disabled]="isDiagnosticTestAddingMode || isDiagnosticTestEditableMode" type="button"
              class="btn  btn-success float-right" (click)="edit(pastDiagnosticTest)">Edit</button>
            <button [disabled]="isDiagnosticTestAddingMode || isDiagnosticTestEditableMode" type="button"
              class="btn  btn-success float-right" (click)="delete(pastDiagnosticTest.id)">Delete</button>
          </td>
        </tr>
        <tr *ngIf="pastDiagnosticTests.length === 0">
          <td colspan="8">No diagnosticTest</td>
        </tr>
      </table>
    </div>
    <!-- DIAGNOSTIC TESTS-->

    <!-- LABORATORY TESTS-->
    <form [formGroup]="chooseLaboratoryTestTypeForm" *ngIf="isEditable">
      <div class="formGroup mb-3">
        <label for="laboratoryTypeTestType">Laboratory Test Type:</label>
        <select id="laboratoryTypeTestType" class="form-control" formControlName="laboratoryTypeTestType">
          <option *ngFor="let laboratoryTestType of laboratoryTestTypes" [ngValue]="laboratoryTestType">
            {{ laboratoryTestType.name }}
          </option>
        </select>
      </div>
      <div>
        <div class="d-flex justify-content-center mb-4">
          <button [disabled]="isDisabled" type="button" class="btn  btn-success float-right mx-2 mt-5 "
            (click)="selectLaboratoryTestType()">Select</button>
        </div>
      </div>
    </form>

    <form [formGroup]="laboratoryTestForm" *ngIf="isLaboratoryTestAddingMode || isLaboratoryTestEditableMode">
      <label for="textbox">Type:</label>
      <input id="laboratoryTestTypeName" formControlName="laboratoryTestTypeName" type="text" class="form-control">
      <p></p>

      <label for="textbox">Note:</label>
      <input id="doctorNote" type="text" formControlName="doctorNote" />

      <div class="d-flex justify-content-center mb-4 mt-5">
        <button *ngIf="isLaboratoryTestAddingMode" type="button" class="btn  btn-success float-right mx-2 "
          (click)="saveLaboratoryTest()">Save laboratory Test</button>
        <button (click)="cancelAddingLaboratoryTest()" class="btn btn-secondary">Cancel</button>
        <button *ngIf="isLaboratoryTestEditableMode" type="button" class="btn  btn-success float-right mx-2 "
          (click)="updateLaboratoryTest()">Save etitioned laboratoryTest</button>
      </div>
    </form>

    <div>
      <table class="table table-striped">
        <thead class="thead-dark">
          <tr>
            <th>
              Laboratory Test
            </th>
            <th>

            </th>
          </tr>
        </thead>
        <tr *ngFor="let pastLaboratoryTest of pastLaboratoryTests">
          <td>
            Laboratory test type: {{pastLaboratoryTest.laboratoryTestTypeName}}
            <br />
            Note: {{pastLaboratoryTest.doctorNote}}
          </td>
          <td *ngIf="isEditable">
            <button [disabled]="isLaboratoryTestAddingMode || isLaboratoryTestEditableMode" type="button"
              class="btn  btn-success float-right" (click)="editLaboratoryTest(pastLaboratoryTest)">Edit</button>
            <button [disabled]="isLaboratoryTestAddingMode || isLaboratoryTestEditableMode" type="button"
              class="btn  btn-success float-right" (click)="deleteLaboratoryTest(pastLaboratoryTest.id)">Delete</button>
          </td>
        </tr>
        <tr *ngIf="pastDiagnosticTests.length === 0">
          <td colspan="8">No Laboratory Tests</td>
        </tr>
      </table>
    </div>
    <!-- LABORATORY TESTS-->

    <div *ngIf="isEditable">
      <button [disabled]="medicalAppointment.patientId==0" (click)="saveAnAppointment()"
        class="btn btn-success w-50">Finish the appointment</button>
      <button [disabled]="medicalAppointment.patientId==0" (click)="cancelAnAppointment()"
        class="btn btn-success w-50">Cancel the appointment</button>

      <!-- <a [routerLink]="['/doctor-appointments', medicalAppointment.doctorId]" class="btn btn-success w-50">Cancel</a> -->
    </div>

  </div>
  <a [routerLink]="['/doctor-appointments' , medicalAppointment.doctorId]" class="btn btn-secondary">Return</a>


</div>





<!--<p>Interview: {{ interview }}</p>
  <p>Diagnosis: {{ interview }}</p> -->